<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Technician Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #000000;
      color: #FFFFFF;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header-bar {
      background-color: #F5F5DC; /* Cream background */
      border-bottom: 3px solid #FDB927; /* Gold bottom border */
      color: #000000; /* Dark text */
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-wrap: wrap;
      gap: 15px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .system-name {
      font-size: 24px;
      font-weight: bold;
      color: #000000;
    }


    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .theme-toggle {
      background-color: #FDB927;
      color: #000000;
      font-weight: bold;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .theme-toggle:hover {
      background-color: #d4a218;
    }


    .logout-btn {
      background-color: #FDB927;
      color: #000000;
      font-weight: bold;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
    }

    .logout-btn:hover {
      background-color: #d4a218;
    }

    /* Dark theme styles */
    body.dark-theme {
      background-color: #1a1a1a;
      color: #FFFFFF;
    }

    body.dark-theme .header-bar {
      background-color: #2d2d2d;
      color: #FFFFFF;
    }

    body.dark-theme .system-name {
      color: #FFFFFF;
    }



    body.dark-theme .container {
      background-color: #2d2d2d;
      color: #FFFFFF;
    }

    /* Dark theme styles for summary cards */
    body.dark-theme .summary-card {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
      color: #FFFFFF;
    }

    body.dark-theme .card-title {
      color: #ccc;
    }

    body.dark-theme .card-value {
      color: #FFFFFF;
    }

    body.dark-theme .card-subtitle {
      color: #aaa;
    }

    body.dark-theme .detail-table th {
      background-color: #404040 !important;
      color: #FFFFFF !important;
      border-bottom-color: #FDB927 !important;
    }
    
    body.dark-theme .detail-table td {
      color: #FFFFFF !important;
      background-color: #2d2d2d !important;
      border-bottom-color: #555555 !important;
    }
    
    body.dark-theme .detail-table tr:hover {
      background-color: #404040 !important;
    }
    
    body.dark-theme .detail-table tr:hover td {
      background-color: #404040 !important;
    }
    
    body.dark-theme .patient-code {
      color: #FFFFFF !important;
      background-color: #555555 !important;
    }
    
    body.dark-theme .status-badge {
      color: #FFFFFF !important;
    }
    
    body.dark-theme .status-eligible {
      background-color: #2d5a2d !important;
      color: #90EE90 !important;
    }
    
    body.dark-theme .status-not-eligible {
      background-color: #5a2d2d !important;
      color: #FFB6C1 !important;
    }
    
    body.dark-theme .status-pending {
      background-color: #5a5a2d !important;
      color: #FFFF99 !important;
    }
    
    body.dark-theme .detail-table button {
      background-color: #FDB927 !important;
      color: #000000 !important;
      border: none !important;
    }
    
    body.dark-theme .detail-table button:hover {
      background-color: #d4a218 !important;
      color: #000000 !important;
    }
    
    body.dark-theme .filter-controls {
      background-color: #404040 !important;
      border-bottom-color: #555555 !important;
    }
    
    body.dark-theme .filter-label {
      color: #FFFFFF !important;
    }
    
    body.dark-theme .filter-input {
      background-color: #2d2d2d !important;
      color: #FFFFFF !important;
      border-color: #555555 !important;
    }
    
    body.dark-theme .filter-input:focus {
      border-color: #FDB927 !important;
    }
    
    body.dark-theme .filter-select {
      background-color: #2d2d2d !important;
      color: #FFFFFF !important;
      border-color: #555555 !important;
    }
    
    body.dark-theme .filter-select:focus {
      border-color: #FDB927 !important;
    }

    body.dark-theme .modal-content {
      background-color: #2d2d2d !important;
      color: #FFFFFF !important;
    }

    body.dark-theme .modal-header {
      background: linear-gradient(135deg, #FDB927 0%, #d4a218 100%);
      color: #000000 !important;
    }
    
    body.dark-theme .modal-header h2 {
      color: #000000 !important;
    }
    
    body.dark-theme .modal-close-btn {
      color: #000000 !important;
    }
    
    body.dark-theme .modal-close-btn:hover {
      background-color: rgba(0, 0, 0, 0.2) !important;
    }

    body.dark-theme .dashboard-actions {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
      color: #FFFFFF;
    }

    body.dark-theme .dashboard-actions h2 {
      color: #FDB927;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      gap: 20px;
      overflow-y: auto;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      width: 100%;
      flex: 1;
    }

    .summary-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-left: 5px solid;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 180px;
    }

    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .summary-card:active {
      transform: translateY(-2px);
    }

    .summary-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      transform: translate(30px, -30px);
    }

    .summary-card.total-patients {
      border-left-color: #FDB927;
    }

    .summary-card.sent-to-doctor {
      border-left-color: #2196f3;
    }

    .summary-card.eligible {
      border-left-color: #4caf50;
    }

    .summary-card.not-eligible {
      border-left-color: #f44336;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .card-icon {
      font-size: 28px;
      opacity: 0.8;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-value {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .card-subtitle {
      font-size: 11px;
      color: #888;
      font-weight: 500;
    }

    .dashboard-content {
      width: 100%;
      max-width: 1400px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .dashboard-actions {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-left: 5px solid #FDB927;
    }

    .dashboard-actions h2 {
      color: #FDB927;
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: bold;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 160px;
      text-decoration: none;
    }

    .action-btn.primary {
      background: linear-gradient(135deg, #FDB927 0%, #d4a218 100%);
      color: #000000;
    }

    .action-btn.secondary {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
      color: #ffffff;
    }

    .action-btn.tertiary {
      background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
      color: #ffffff;
    }

    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .action-btn.primary:hover {
      background: linear-gradient(135deg, #d4a218 0%, #b8941f 100%);
    }

    .action-btn.secondary:hover {
      background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
    }

    .action-btn.tertiary:hover {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
    }

    .btn-icon {
      font-size: 24px;
    }

    .btn-text {
      font-size: 14px;
      text-align: center;
    }

    /* Responsive Design Improvements */
    @media (min-width: 1200px) {
      .summary-cards {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .action-buttons {
        gap: 20px;
      }
      
      .action-btn {
        min-width: 180px;
        padding: 18px 22px;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 15px;
        gap: 15px;
      }
      
      .dashboard-content {
        gap: 15px;
      }
      
      .summary-cards {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }
      
      .action-buttons {
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }
      
      .action-btn {
        width: 100%;
        max-width: 300px;
        min-width: auto;
      }
      
      .dashboard-actions {
        padding: 15px;
      }
      
      .dashboard-actions h2 {
        font-size: 20px;
        margin-bottom: 15px;
      }
    }

    @media (max-width: 480px) {
      .summary-cards {
        grid-template-columns: 1fr;
      }
      
      .summary-card {
        min-height: 160px;
        padding: 15px;
      }
      
      .card-value {
        font-size: 28px;
      }
      
      .card-icon {
        font-size: 24px;
      }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
      display: flex !important;
      background-color: rgba(0, 0, 0, 0.7) !important;
    }

    .modal-content {
      background-color: #ffffff !important;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 90vw;
      max-height: 90vh;
      width: 1200px;
      overflow: hidden;
      animation: modalSlideIn 0.3s ease-out;
      border: 3px solid #FDB927 !important;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #FDB927 0%, #d4a218 100%);
      color: #000000;
      padding: 20px 25px;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #d4a218;
    }

    .modal-close-btn {
      background: none;
      border: none;
      color: #000000;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .modal-close-btn:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .modal-body {
      max-height: 70vh;
      overflow-y: auto;
      padding: 0;
    }

    .detail-section {
      display: none;
    }

    .detail-section.active {
      display: block;
    }

    .detail-table {
      background-color: #ffffff;
      border-radius: 0;
      box-shadow: none;
      overflow: hidden;
      margin: 0;
    }

    .table-container {
      overflow-x: auto;
    }

    .detail-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .detail-table th {
      background-color: #f8f9fa !important;
      color: #333 !important;
      font-weight: 600 !important;
      padding: 15px 12px;
      text-align: left;
      border-bottom: 2px solid #FDB927;
      font-size: 14px !important;
    }

    .detail-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      vertical-align: top;
      color: #333 !important;
      font-size: 14px !important;
      font-weight: normal !important;
      background-color: #ffffff !important;
    }

    .detail-table tr:hover {
      background-color: #f8f9fa;
    }

    /* Enhanced clickable row styles */
    .detail-table tr[onclick] {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .detail-table tr[onclick]:hover {
      background-color: rgba(253, 185, 39, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(253, 185, 39, 0.3);
    }

    .detail-table tr[onclick]:active {
      background-color: rgba(253, 185, 39, 0.3);
      transform: translateY(0);
    }

    .detail-table tr:last-child td {
      border-bottom: none;
    }
    
    /* Filter Controls */
    .filter-controls {
      padding: 15px 20px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #eee;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filter-input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background-color: #ffffff;
      color: #333;
      min-width: 200px;
    }
    
    .filter-input:focus {
      outline: none;
      border-color: #FDB927;
      box-shadow: 0 0 3px rgba(253, 185, 39, 0.3);
    }
    
    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background-color: #ffffff;
      color: #333;
      min-width: 150px;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: #FDB927;
    }
    
    .filter-label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-right: 5px;
    }
    
    .clear-filters-btn {
      background-color: #6c757d;
      color: #ffffff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .clear-filters-btn:hover {
      background-color: #5a6268;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-eligible {
      background-color: #d4edda;
      color: #155724;
    }

    .status-not-eligible {
      background-color: #f8d7da;
      color: #721c24;
    }

    .status-sent-to-doctor {
      background-color: #cce7ff;
      color: #004085;
    }

    .patient-code {
      font-family: monospace;
      background-color: #f8f9fa;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      color: #333 !important;
      font-weight: bold;
    }

    .container {
      background-color: #FFFFFF;
      color: #000000;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 1400px;
      margin-top: 20px;
    }

    h2, h3 {
      color: #FDB927;
      text-align: center;
    }

    p {
      margin: 6px 0;
    }

    img {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    hr {
      margin: 20px 0;
    }

    button {
      background-color: #FDB927;
      color: #000000;
      font-weight: bold;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px;
    }

    button:hover {
      background-color: #d4a218;
    }

    #output {
      margin-top: 30px;
    }

    .eligible {
      color: green;
      font-weight: bold;
    }

    .not-eligible {
      color: red;
      font-weight: bold;
    }

    /* Footer Styles */
    .footer {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
      color: #FFFFFF;
      padding: 15px 0 10px 0;
      margin-top: auto;
      border-top: 2px solid #FDB927;
    }

    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 15px;
    }

    .footer-section h4 {
      color: #FDB927;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .quick-stats {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
    }

    .stat-label {
      color: #ccc;
    }

    .stat-value {
      color: #FDB927;
      font-weight: bold;
    }

    .support-links {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .support-links a {
      color: #ccc;
      text-decoration: none;
      font-size: 12px;
      transition: color 0.3s ease;
    }

    .support-links a:hover {
      color: #FDB927;
    }

    .footer-bottom {
      border-top: 1px solid #404040;
      padding-top: 10px;
      text-align: center;
      color: #888;
      font-size: 11px;
    }

    .footer-bottom p {
      margin: 3px 0;
    }

    /* Dark theme footer styles */
    body.dark-theme .footer {
      background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
    }

    body.dark-theme .footer-section h4 {
      color: #FDB927;
    }

    body.dark-theme .status-item,
    body.dark-theme .stat-label,
    body.dark-theme .support-links a {
      color: #ccc;
    }

    body.dark-theme .stat-value {
      color: #FDB927;
    }

    body.dark-theme .footer-bottom {
      border-top-color: #333;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="header-bar">
    <div class="header-left">
      <div class="system-name">Stroke Detection System</div>
    </div>
    
    <div class="header-right">
      <button class="theme-toggle" onclick="toggleTheme()" title="üåô Theme Toggle - Light/Dark comfort mode">
        üåô Theme
      </button>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="main-content">
    <div class="dashboard-content">
      <!-- Dashboard Actions Section -->
      <div class="dashboard-actions">
        <h2>Technician Dashboard</h2>
        <div class="action-buttons">
          <button onclick="window.location.href='/add-patient'" class="action-btn primary">
            <span class="btn-icon">‚ûï</span>
            <span class="btn-text">Add New Patient</span>
          </button>
          <button onclick="showUploadForPatient()" class="action-btn secondary">
            <span class="btn-icon">üì§</span>
            <span class="btn-text">Upload Scans for Patient</span>
          </button>
          <button onclick="loadPatients()" class="action-btn tertiary">
            <span class="btn-icon">üë•</span>
            <span class="btn-text">View All Existing Patients</span>
          </button>
        </div>
      </div>

      <!-- Summary Cards Section -->
      <div class="summary-cards">
        <div class="summary-card total-patients" onclick="showPatientDetailsFromCard('total-patients')">
          <div class="card-header">
            <div class="card-title">Total Patients</div>
            <div class="card-icon">üë•</div>
          </div>
          <div class="card-value" id="totalPatients">-</div>
          <div class="card-subtitle">Registered in system</div>
        </div>

        <div class="summary-card eligible" onclick="showPatientDetailsFromCard('eligible')">
          <div class="card-header">
            <div class="card-title">Eligible for tPA</div>
            <div class="card-icon">‚úÖ</div>
          </div>
          <div class="card-value" id="eligiblePatients">-</div>
          <div class="card-subtitle">Ready for treatment</div>
        </div>

        <div class="summary-card not-eligible" onclick="showPatientDetailsFromCard('not-eligible')">
          <div class="card-header">
            <div class="card-title">Not Eligible</div>
            <div class="card-icon">‚ùå</div>
          </div>
          <div class="card-value" id="notEligiblePatients">-</div>
          <div class="card-subtitle">Requires alternative care</div>
        </div>

        <div class="summary-card sent-to-doctor" onclick="showPatientDetailsFromCard('sent-to-doctor')">
          <div class="card-header">
            <div class="card-title">Sent to Doctor for Review</div>
            <div class="card-icon">üë®‚Äç‚öïÔ∏è</div>
          </div>
          <div class="card-value" id="sentToDoctorScans">-</div>
          <div class="card-subtitle">Awaiting doctor review</div>
        </div>
        
      </div>

      <!-- Patient List Output -->
      <div class="container" id="output-container" style="display: none;">
        <div id="output"></div>
      </div>

      <!-- Modal Popup -->
      <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
          <div class="modal-header">
            <span id="modalTitle">Details</span>
            <button class="modal-close-btn" onclick="hideModal()">√ó</button>
          </div>
          <div class="modal-body">
            <div class="detail-section" id="total-patients-detail">
              <div class="filter-controls">
                <span class="filter-label">üîç Search:</span>
                <input type="text" class="filter-input" id="total-patients-search" placeholder="Search by name, code, or complaint..." onkeyup="filterTable('total-patients')">
                <span class="filter-label">üë§ Gender:</span>
                <select class="filter-select" id="total-patients-gender" onchange="filterTable('total-patients')">
                  <option value="">All</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <span class="filter-label">üìä Age:</span>
                <select class="filter-select" id="total-patients-age" onchange="filterTable('total-patients')">
                  <option value="">All Ages</option>
                  <option value="0-30">0-30</option>
                  <option value="31-50">31-50</option>
                  <option value="51-70">51-70</option>
                  <option value="71+">71+</option>
                </select>
                <button class="clear-filters-btn" onclick="clearFilters('total-patients')">Clear Filters</button>
              </div>
              <div class="detail-table">
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Patient Code</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Chief Complaint</th>
                        <th>Scans</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="total-patients-table">
                      <!-- Data will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="detail-section" id="sent-to-doctor-detail">
              <div class="filter-controls">
                <span class="filter-label">üîç Search:</span>
                <input type="text" class="filter-input" id="sent-to-doctor-search" placeholder="Search by name, code, or complaint..." onkeyup="filterTable('sent-to-doctor')">
                <span class="filter-label">üë§ Gender:</span>
                <select class="filter-select" id="sent-to-doctor-gender" onchange="filterTable('sent-to-doctor')">
                  <option value="">All</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <span class="filter-label">üìÖ Upload Date:</span>
                <select class="filter-select" id="sent-to-doctor-date" onchange="filterTable('sent-to-doctor')">
                  <option value="">All Dates</option>
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
                <button class="clear-filters-btn" onclick="clearFilters('sent-to-doctor')">Clear Filters</button>
              </div>
              <div class="detail-table">
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Patient Code</th>
                        <th>Patient Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Chief Complaint</th>
                        <th>Scan ID</th>
                        <th>Upload Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="sent-to-doctor-table">
                      <!-- Data will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="detail-section" id="eligible-detail">
              <div class="filter-controls">
                <span class="filter-label">üîç Search:</span>
                <input type="text" class="filter-input" id="eligible-search" placeholder="Search by name, code, or diagnosis..." onkeyup="filterTable('eligible')">
                <span class="filter-label">üë§ Gender:</span>
                <select class="filter-select" id="eligible-gender" onchange="filterTable('eligible')">
                  <option value="">All</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <span class="filter-label">üè• Diagnosis:</span>
                <select class="filter-select" id="eligible-diagnosis" onchange="filterTable('eligible')">
                  <option value="">All Diagnoses</option>
                  <option value="Ischemic Stroke">Ischemic Stroke</option>
                  <option value="Hemorrhagic Stroke">Hemorrhagic Stroke</option>
                  <option value="TIA">TIA</option>
                </select>
                <button class="clear-filters-btn" onclick="clearFilters('eligible')">Clear Filters</button>
              </div>
              <div class="detail-table">
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Patient Code</th>
                        <th>Patient Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Chief Complaint</th>
                        <th>Scan ID</th>
                        <th>Diagnosis</th>
                        <th>Eligibility Result</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="eligible-table">
                      <!-- Data will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="detail-section" id="not-eligible-detail">
              <div class="filter-controls">
                <span class="filter-label">üîç Search:</span>
                <input type="text" class="filter-input" id="not-eligible-search" placeholder="Search by name, code, or diagnosis..." onkeyup="filterTable('not-eligible')">
                <span class="filter-label">üë§ Gender:</span>
                <select class="filter-select" id="not-eligible-gender" onchange="filterTable('not-eligible')">
                  <option value="">All</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <span class="filter-label">üè• Diagnosis:</span>
                <select class="filter-select" id="not-eligible-diagnosis" onchange="filterTable('not-eligible')">
                  <option value="">All Diagnoses</option>
                  <option value="Ischemic Stroke">Ischemic Stroke</option>
                  <option value="Hemorrhagic Stroke">Hemorrhagic Stroke</option>
                  <option value="TIA">TIA</option>
                </select>
                <button class="clear-filters-btn" onclick="clearFilters('not-eligible')">Clear Filters</button>
              </div>
              <div class="detail-table">
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Patient Code</th>
                        <th>Patient Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Chief Complaint</th>
                        <th>Scan ID</th>
                        <th>Diagnosis</th>
                        <th>Eligibility Result</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="not-eligible-table">
                      <!-- Data will be loaded here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4>Quick Stats</h4>
        <div class="quick-stats">
          <div class="stat-item">
            <span class="stat-label">Today's Scans:</span>
            <span class="stat-value" id="todayScans">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg. Processing Time:</span>
            <span class="stat-value">2.3 min</span>
          </div>
        </div>
      </div>
      
      <div class="footer-section">
        <h4>Support</h4>
        <div class="support-links">
          <a href="#" onclick="showHelp()">Help & Documentation</a>
          <a href="#" onclick="showContact()">Contact Support</a>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2024 Stroke Detection System - Grambling State University</p>
      <p>Version 1.2.0 | Last Updated: <span id="lastUpdate">Loading...</span></p>
    </div>
  </footer>

  <script>
    // Theme toggle functionality
    function toggleTheme() {
      document.body.classList.toggle('dark-theme');
      const isDark = document.body.classList.contains('dark-theme');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      
      // Update theme button text
      const themeBtn = document.querySelector('.theme-toggle');
      themeBtn.innerHTML = isDark ? '‚òÄÔ∏è Theme' : 'üåô Theme';
    }

    // Load saved theme on page load
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        const themeBtn = document.querySelector('.theme-toggle');
        themeBtn.innerHTML = '‚òÄÔ∏è Theme';
      }
    }



    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        // Call logout endpoint to clear session
        fetch('/logout', { method: 'POST' })
          .then(() => {
            window.location.href = '/login-page';
          })
          .catch(() => {
            // Even if logout fails, redirect to login
            window.location.href = '/login-page';
          });
      }
    }

    // Load dashboard statistics
    async function loadDashboardStats() {
      try {
        const response = await fetch('/dashboard-stats');
        if (response.ok) {
          const stats = await response.json();
          
          // Update the summary cards with real data
          document.getElementById('totalPatients').textContent = stats.total_patients;
          document.getElementById('sentToDoctorScans').textContent = stats.sent_to_doctor_scans;
          document.getElementById('eligiblePatients').textContent = stats.eligible_scans;
          document.getElementById('notEligiblePatients').textContent = stats.not_eligible_scans;
          
        } else {
          console.error('Failed to load dashboard stats:', response.status);
          // Set fallback values
          document.getElementById('totalPatients').textContent = '0';
          document.getElementById('sentToDoctorScans').textContent = '0';
          document.getElementById('eligiblePatients').textContent = '0';
          document.getElementById('notEligiblePatients').textContent = '0';
        }
      } catch (error) {
        console.error('Error loading dashboard stats:', error);
        // Set fallback values
        document.getElementById('totalPatients').textContent = '0';
        document.getElementById('sentToDoctorScans').textContent = '0';
        document.getElementById('eligiblePatients').textContent = '0';
        document.getElementById('notEligiblePatients').textContent = '0';
      }
    }


    // Show patient details directly when clicking on cards
    async function showPatientDetailsFromCard(cardType) {
      console.log('=== CARD CLICK DEBUG ===');
      console.log('Showing patient details for card:', cardType);
      
      try {
        // Load data for the specific card type
        console.log('Fetching data from:', `/dashboard-details/${cardType}`);
        const response = await fetch(`/dashboard-details/${cardType}?t=${Date.now()}`);
        
        if (response.ok) {
          const data = await response.json();
          console.log('=== API RESPONSE ===');
          console.log('Received data for', cardType, ':', data);
          console.log('Data length:', data.length);
          if (data.length > 0) {
            console.log('First item:', data[0]);
            console.log('Available fields:', Object.keys(data[0]));
            console.log('patient_name:', data[0].patient_name);
            console.log('patient_age:', data[0].patient_age);
            console.log('patient_gender:', data[0].patient_gender);
            console.log('chief_complaint:', data[0].chief_complaint);
          }
          
          if (data.length === 0) {
            alert('No patients found in this category.');
            return;
          }
          
          // Always show the modal for now (removed single patient redirect)
          console.log('Showing selection modal for', data.length, 'patients');
          showPatientSelectionModal(cardType, data);
          
        } else {
          console.error(`Failed to load ${cardType} data:`, response.status);
          alert('Failed to load patient data. Please try again.');
        }
      } catch (error) {
        console.error(`Error loading ${cardType} data:`, error);
        alert('Error loading patient data. Please try again.');
      }
    }

    // Show patient selection modal when multiple patients exist
    function showPatientSelectionModal(cardType, patients) {
      console.log('=== SHOWING PATIENT SELECTION MODAL ===');
      console.log('Card type:', cardType, 'Patients:', patients);
      
      const modalTitle = document.getElementById('modalTitle');
      const titles = {
        'total-patients': 'üë• Select Patient',
        'sent-to-doctor': 'üë®‚Äç‚öïÔ∏è Select Patient',
        'eligible': '‚úÖ Select Patient',
        'not-eligible': '‚ùå Select Patient'
      };
      modalTitle.textContent = titles[cardType] || 'Select Patient';
      
      // Hide all detail sections first
      hideDetailTable();
      
      // Show the selected detail section
      const detailSection = document.getElementById(`${cardType}-detail`);
      console.log('Detail section element:', detailSection);
      
      if (detailSection) {
        detailSection.classList.add('active');
        console.log('Detail section activated');
        
        // Show the modal
        const modal = document.getElementById('detailModal');
        console.log('Modal element:', modal);
        modal.classList.add('active');
        console.log('Modal activated');
        
        // Force a reflow to ensure the modal is visible
        modal.offsetHeight;
        
        // Populate the table with clickable rows
        populatePatientSelectionTable(cardType, patients);
        
        // Additional debugging
        console.log('Modal display style:', window.getComputedStyle(modal).display);
        console.log('Detail section display style:', window.getComputedStyle(detailSection).display);
        
      } else {
        console.error('Detail section not found for:', cardType);
        alert('Error: Detail section not found. Please check the console for details.');
      }
    }

    // Populate table for patient selection
    function populatePatientSelectionTable(cardType, patients) {
      console.log('Populating table for cardType:', cardType, 'with patients:', patients);
      
      let tableId;
      if (cardType === 'total-patients') {
        tableId = 'total-patients-table';
      } else if (cardType === 'sent-to-doctor') {
        tableId = 'sent-to-doctor-table';
      } else if (cardType === 'eligible') {
        tableId = 'eligible-table';
      } else if (cardType === 'not-eligible') {
        tableId = 'not-eligible-table';
      }
      
      const tableBody = document.getElementById(tableId);
      
      if (!tableBody) {
        console.error('Table body not found for ID:', tableId);
        return;
      }

      if (patients.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #333;">No data available</td></tr>';
        return;
      }

      let html = '';
      
      if (cardType === 'total-patients') {
        patients.forEach(patient => {
          html += `
            <tr onclick="viewPatientDetails('${patient.code}')" style="cursor: pointer;">
              <td><span class="patient-code">${patient.code || 'N/A'}</span></td>
              <td>${patient.name || 'N/A'}</td>
              <td>${patient.age || 'N/A'}</td>
              <td>${patient.gender || 'N/A'}</td>
              <td>${patient.chief_complaint || 'N/A'}</td>
              <td>${patient.scan_count || 0} scan(s)</td>
              <td>
                <button onclick="event.stopPropagation(); viewPatientDetails('${patient.code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
              </td>
            </tr>
          `;
        });
      } else {
        // For scan-based tables
        patients.forEach(item => {
          console.log('Processing scan item:', item);
          const statusClass = cardType === 'eligible' ? 'status-eligible' : 
                             cardType === 'not-eligible' ? 'status-not-eligible' : 
                             cardType === 'sent-to-doctor' ? 'status-sent-to-doctor' :
                             'status-pending';
          const statusText = cardType === 'eligible' ? 'Eligible' : 
                            cardType === 'not-eligible' ? 'Not Eligible' : 
                            cardType === 'sent-to-doctor' ? 'Sent to Doctor' :
                            'Pending';
          
          if (cardType === 'sent-to-doctor') {
            console.log('Creating sent-to-doctor row for:', item);
            html += `
              <tr onclick="viewPatientDetails('${item.patient_code}')" style="cursor: pointer;">
                <td><span class="patient-code">${item.patient_code || 'N/A'}</span></td>
                <td>${item.patient_name || 'N/A'}</td>
                <td>${item.patient_age || 'N/A'}</td>
                <td>${item.patient_gender || 'N/A'}</td>
                <td>${item.chief_complaint || 'N/A'}</td>
                <td>#${item.scan_id || 'N/A'}</td>
                <td>${item.upload_date || 'N/A'}</td>
                <td><span class="status-badge ${statusClass}">${item.status || statusText}</span></td>
                <td>
                  <button onclick="event.stopPropagation(); viewPatientDetails('${item.patient_code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
                </td>
              </tr>
            `;
          } else {
            // For eligible and not-eligible tables
            console.log('Creating eligible/not-eligible row for:', item);
            console.log('Item fields:', {
              patient_code: item.patient_code,
              patient_name: item.patient_name,
              patient_age: item.patient_age,
              patient_gender: item.patient_gender,
              chief_complaint: item.chief_complaint,
              scan_id: item.scan_id,
              diagnosis: item.diagnosis
            });
            html += `
              <tr onclick="viewPatientDetails('${item.patient_code}')" style="cursor: pointer;">
                <td><span class="patient-code">${item.patient_code || 'N/A'}</span></td>
                <td>${item.patient_name || 'N/A'}</td>
                <td>${item.patient_age || 'N/A'}</td>
                <td>${item.patient_gender || 'N/A'}</td>
                <td>${item.chief_complaint || 'N/A'}</td>
                <td>#${item.scan_id || 'N/A'}</td>
                <td>${item.diagnosis || 'N/A'}</td>
                <td><span class="status-badge ${statusClass}">${item.eligibility_result || statusText}</span></td>
                <td>
                  <button onclick="event.stopPropagation(); viewPatientDetails('${item.patient_code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
                </td>
              </tr>
            `;
          }
        });
      }
      
      console.log('=== FINAL HTML ===');
      console.log('Generated HTML for', cardType, ':', html);
      tableBody.innerHTML = html;
      console.log('HTML set to table body');
      
      // Additional debugging
      console.log('Table body children count:', tableBody.children.length);
      console.log('Table body innerHTML length:', tableBody.innerHTML.length);
      
      // Check if the table is visible
      const table = tableBody.closest('table');
      if (table) {
        console.log('Table element found:', table);
        console.log('Table display style:', window.getComputedStyle(table).display);
        console.log('Table visibility:', window.getComputedStyle(table).visibility);
      }
    }

    // Show detail table for clicked card (kept for backward compatibility)
    async function showDetailTable(cardType) {
      console.log('Showing detail table for:', cardType);
      
      // Set modal title based on card type
      const modalTitle = document.getElementById('modalTitle');
      const titles = {
        'total-patients': 'üë• All Patients',
        'sent-to-doctor': '‚è≥ Pending Scans',
        'eligible': '‚úÖ Eligible for tPA',
        'not-eligible': '‚ùå Not Eligible'
      };
      modalTitle.textContent = titles[cardType] || 'Details';
      
      // Hide all detail sections first
      hideDetailTable();
      
      // Show the selected detail section
      const detailSection = document.getElementById(`${cardType}-detail`);
      console.log('Detail section element:', detailSection);
      
      if (detailSection) {
        detailSection.classList.add('active');
        console.log('Detail section activated');
        
        // Show the modal
        const modal = document.getElementById('detailModal');
        modal.classList.add('active');
        
        // Load data for the specific table
        await loadDetailTableData(cardType);
      } else {
        console.error('Detail section not found for:', cardType);
      }
    }

    // Hide modal
    function hideModal() {
      const modal = document.getElementById('detailModal');
      modal.classList.remove('active');
      hideDetailTable();
    }

    // Hide detail table
    function hideDetailTable() {
      const detailSections = document.querySelectorAll('.detail-section');
      detailSections.forEach(section => {
        section.classList.remove('active');
      });
    }

    // Load data for detail tables
    async function loadDetailTableData(cardType) {
      console.log('Loading data for:', cardType);
      try {
        const response = await fetch(`/dashboard-details/${cardType}`);
        console.log('API response:', response);
        
        if (response.ok) {
          const data = await response.json();
          console.log('Received data:', data);
          populateDetailTable(cardType, data);
        } else {
          console.error(`Failed to load ${cardType} data:`, response.status);
        }
      } catch (error) {
        console.error(`Error loading ${cardType} data:`, error);
      }
    }

    // Populate detail table with data
    function populateDetailTable(cardType, data) {
      console.log('Populating table for:', cardType, 'with data:', data);
      
      // Fix the table ID selection
      let tableId;
      if (cardType === 'total-patients') {
        tableId = 'total-patients-table';
      } else if (cardType === 'sent-to-doctor') {
        tableId = 'sent-to-doctor-table';
      } else if (cardType === 'eligible') {
        tableId = 'eligible-table';
      } else if (cardType === 'not-eligible') {
        tableId = 'not-eligible-table';
      }
      
      const tableBody = document.getElementById(tableId);
      console.log('Table body element:', tableBody);
      
      if (!tableBody) {
        console.error('Table body not found for ID:', tableId);
        return;
      }

      if (data.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px; color: #333;">No data available</td></tr>';
        return;
      }

      let html = '';
      
      if (cardType === 'total-patients') {
        data.forEach(patient => {
          html += `
            <tr>
              <td><span class="patient-code">${patient.code || 'N/A'}</span></td>
              <td>${patient.name || 'N/A'}</td>
              <td>${patient.age || 'N/A'}</td>
              <td>${patient.gender || 'N/A'}</td>
              <td>${patient.chief_complaint || 'N/A'}</td>
              <td>${patient.scan_count || 0} scan(s)</td>
              <td>
                <button onclick="viewPatientDetails('${patient.code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
              </td>
            </tr>
          `;
        });
      } else {
        // For scan-based tables - UPDATED TO MATCH NEW TABLE STRUCTURE
        data.forEach(item => {
          console.log('Processing item in populateDetailTable:', item);
          const statusClass = cardType === 'eligible' ? 'status-eligible' : 
                             cardType === 'not-eligible' ? 'status-not-eligible' : 
                             cardType === 'sent-to-doctor' ? 'status-sent-to-doctor' :
                             'status-pending';
          const statusText = cardType === 'eligible' ? 'Eligible' : 
                            cardType === 'not-eligible' ? 'Not Eligible' : 
                            cardType === 'sent-to-doctor' ? 'Sent to Doctor' :
                            'Pending';
          
          if (cardType === 'sent-to-doctor') {
            html += `
              <tr>
                <td><span class="patient-code">${item.patient_code || 'N/A'}</span></td>
                <td>${item.patient_name || 'N/A'}</td>
                <td>${item.patient_age || 'N/A'}</td>
                <td>${item.patient_gender || 'N/A'}</td>
                <td>${item.chief_complaint || 'N/A'}</td>
                <td>#${item.scan_id || 'N/A'}</td>
                <td>${item.upload_date || 'N/A'}</td>
                <td><span class="status-badge ${statusClass}">${item.status || statusText}</span></td>
                <td>
                  <button onclick="viewScanDetails(${item.scan_id}, '${item.patient_code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
                </td>
              </tr>
            `;
          } else {
            // For eligible and not-eligible tables
            html += `
              <tr>
                <td><span class="patient-code">${item.patient_code || 'N/A'}</span></td>
                <td>${item.patient_name || 'N/A'}</td>
                <td>${item.patient_age || 'N/A'}</td>
                <td>${item.patient_gender || 'N/A'}</td>
                <td>${item.chief_complaint || 'N/A'}</td>
                <td>#${item.scan_id || 'N/A'}</td>
                <td>${item.diagnosis || 'N/A'}</td>
                <td><span class="status-badge ${statusClass}">${item.eligibility_result || statusText}</span></td>
                <td>
                  <button onclick="viewScanDetails(${item.scan_id}, '${item.patient_code}')" style="background-color: #FDB927; color: #000; padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">View</button>
                </td>
              </tr>
            `;
          }
        });
      }
      
      console.log('Generated HTML:', html);
      tableBody.innerHTML = html;
    }

    // View patient details
    function viewPatientDetails(patientCode) {
      // Navigate to patient details page with patient code
      window.location.href = `/patient-details?code=${patientCode}`;
    }

    // Filter table functionality
    function filterTable(tableType) {
      const tableBody = document.getElementById(`${tableType}-table`);
      const searchInput = document.getElementById(`${tableType}-search`);
      const genderSelect = document.getElementById(`${tableType}-gender`);
      const ageSelect = document.getElementById(`${tableType}-age`);
      const dateSelect = document.getElementById(`${tableType}-date`);
      const diagnosisSelect = document.getElementById(`${tableType}-diagnosis`);
      
      if (!tableBody) return;
      
      const rows = tableBody.querySelectorAll('tr');
      const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
      const genderFilter = genderSelect ? genderSelect.value : '';
      const ageFilter = ageSelect ? ageSelect.value : '';
      const dateFilter = dateSelect ? dateSelect.value : '';
      const diagnosisFilter = diagnosisSelect ? diagnosisSelect.value : '';
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length === 0) return; // Skip empty rows
        
        let showRow = true;
        
        // Search filter
        if (searchTerm) {
          const rowText = row.textContent.toLowerCase();
          showRow = showRow && rowText.includes(searchTerm);
        }
        
        // Gender filter
        if (genderFilter && cells.length > 3) {
          const genderCell = cells[3].textContent.trim();
          showRow = showRow && genderCell === genderFilter;
        }
        
        // Age filter
        if (ageFilter && cells.length > 2) {
          const ageCell = parseInt(cells[2].textContent.trim());
          if (!isNaN(ageCell)) {
            switch (ageFilter) {
              case '0-30':
                showRow = showRow && ageCell >= 0 && ageCell <= 30;
                break;
              case '31-50':
                showRow = showRow && ageCell >= 31 && ageCell <= 50;
                break;
              case '51-70':
                showRow = showRow && ageCell >= 51 && ageCell <= 70;
                break;
              case '71+':
                showRow = showRow && ageCell >= 71;
                break;
            }
          }
        }
        
        // Date filter (for pending scans)
        if (dateFilter && cells.length > 6) {
          const dateCell = cells[6].textContent.trim();
          const today = new Date();
          const cellDate = new Date(dateCell);
          
          if (!isNaN(cellDate.getTime())) {
            switch (dateFilter) {
              case 'today':
                showRow = showRow && cellDate.toDateString() === today.toDateString();
                break;
              case 'week':
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                showRow = showRow && cellDate >= weekAgo;
                break;
              case 'month':
                const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                showRow = showRow && cellDate >= monthAgo;
                break;
            }
          }
        }
        
        // Diagnosis filter
        if (diagnosisFilter && cells.length > 6) {
          const diagnosisCell = cells[6].textContent.trim();
          showRow = showRow && diagnosisCell.includes(diagnosisFilter);
        }
        
        row.style.display = showRow ? '' : 'none';
      });
      
      // Update row count
      updateRowCount(tableType);
    }
    
    // Clear all filters
    function clearFilters(tableType) {
      const searchInput = document.getElementById(`${tableType}-search`);
      const genderSelect = document.getElementById(`${tableType}-gender`);
      const ageSelect = document.getElementById(`${tableType}-age`);
      const dateSelect = document.getElementById(`${tableType}-date`);
      const diagnosisSelect = document.getElementById(`${tableType}-diagnosis`);
      
      if (searchInput) searchInput.value = '';
      if (genderSelect) genderSelect.value = '';
      if (ageSelect) ageSelect.value = '';
      if (dateSelect) dateSelect.value = '';
      if (diagnosisSelect) diagnosisSelect.value = '';
      
      // Show all rows
      const tableBody = document.getElementById(`${tableType}-table`);
      if (tableBody) {
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
          row.style.display = '';
        });
      }
      
      updateRowCount(tableType);
    }
    
    // Update row count display
    function updateRowCount(tableType) {
      const tableBody = document.getElementById(`${tableType}-table`);
      if (!tableBody) return;
      
      const visibleRows = tableBody.querySelectorAll('tr:not([style*="display: none"])');
      const totalRows = tableBody.querySelectorAll('tr').length;
      
      // You can add a row count display here if needed
      console.log(`${tableType}: ${visibleRows.length} of ${totalRows} rows visible`);
    }

    // Initialize theme and dashboard on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadTheme();
      loadDashboardStats();
      loadTodayScans();
      updateLastUpdateTime();
    });

    // Add click-outside-to-close and ESC key support
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('detailModal');
      if (event.target === modal) {
        hideModal();
      }
    });

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        hideModal();
      }
    });

    async function loadPatients() {
      const output = document.getElementById("output");
      const outputContainer = document.getElementById("output-container");
      
      // Show the output container
      outputContainer.style.display = "block";
      
      output.innerHTML = "Loading patients...";

      try {
        const res = await fetch("/patients/");
        const patients = await res.json();

        if (!res.ok || patients.length === 0) {
          output.innerHTML = "<p>No patients found in the database.</p>";
          return;
        }

        // Create table header
        let html = `
          <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h2 style="color: #FDB927; margin-top: 0;">üë• All Existing Patients</h2>
            <p style="color: #666; margin-bottom: 0;">Total: ${patients.length} patients</p>
          </div>
          
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
              <thead>
                <tr style="background-color: #FDB927; color: #000;">
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Patient Code</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Name</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Age</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Gender</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Chief Complaint</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Blood Pressure</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Glucose</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">INR</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Scans</th>
                  <th style="padding: 15px 12px; text-align: left; font-weight: 600; font-size: 14px;">Actions</th>
                </tr>
              </thead>
              <tbody>
        `;

        // Process each patient and add to table
        for (const p of patients) {
          // Get scan count for this patient
          let scanCount = 0;
          let eligibleScans = 0;
          let notEligibleScans = 0;
          
          try {
            const scansRes = await fetch(`/patients/${p.code}/scans`);
            const scansData = await scansRes.json();
            
            if (scansRes.ok && scansData.scans && scansData.scans.length > 0) {
              scanCount = scansData.scans.length;
              scansData.scans.forEach(scan => {
                if (scan.eligible === true) eligibleScans++;
                else if (scan.eligible === false) notEligibleScans++;
              });
            }
          } catch (err) {
            console.log(`Error loading scans for patient ${p.code}:`, err);
          }

          // Create scan summary
          let scanSummary = scanCount === 0 ? 
            '<span style="color: #666; font-style: italic;">No scans</span>' :
            `<span style="color: #28a745;">‚úÖ ${eligibleScans}</span> / <span style="color: #dc3545;">‚ùå ${notEligibleScans}</span>`;

          html += `
            <tr style="border-bottom: 1px solid #eee;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
              <td style="padding: 12px;">
                <span style="font-family: monospace; background-color: #f8f9fa; padding: 4px 8px; border-radius: 4px; font-size: 12px; color: #333; font-weight: bold;">${p.code}</span>
              </td>
              <td style="padding: 12px; font-weight: 600; color: #333;">${p.name}</td>
              <td style="padding: 12px; color: #333;">${p.age} yrs</td>
              <td style="padding: 12px; color: #333;">${p.gender}</td>
              <td style="padding: 12px; color: #333; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${p.chief_complaint}">${p.chief_complaint}</td>
              <td style="padding: 12px; color: #333;">${p.systolic_bp ?? "N/A"}/${p.diastolic_bp ?? "N/A"}</td>
              <td style="padding: 12px; color: #333;">${p.glucose ?? "N/A"} mg/dL</td>
              <td style="padding: 12px; color: #333;">${p.inr ?? "N/A"}</td>
              <td style="padding: 12px; text-align: center;">${scanSummary}</td>
              <td style="padding: 12px;">
                <button onclick="viewPatientDetails('${p.code}')" style="background-color: #FDB927; color: #000; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; margin-right: 5px;">View</button>
                <button onclick="window.location.href='/upload-form?patient=${p.code}'" style="background-color: #2196f3; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">Upload</button>
              </td>
            </tr>
          `;
        }

        html += `
              </tbody>
            </table>
          </div>
          
          <div style="margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 6px; font-size: 14px; color: #666;">
            <strong>Legend:</strong> 
            <span style="color: #28a745;">‚úÖ Eligible</span> = Eligible for tPA treatment | 
            <span style="color: #dc3545;">‚ùå Not Eligible</span> = Not eligible for tPA treatment
          </div>
        `;

        output.innerHTML = html;
      } catch (err) {
        output.innerHTML = `<p style="color:red;">Something went wrong. Try refreshing.</p>`;
        console.error(err);
      }
    }

    // Function for "Upload Scans for Patient" button
    function showUploadForPatient() {
      // For now, redirect to the upload form
      // In the future, this could show a modal to select a patient first
      window.location.href = '/upload-form';
    }

    // Footer functionality
    function showHelp() {
      alert('Help & Documentation\n\n‚Ä¢ Use the summary cards to view detailed patient information\n‚Ä¢ Click "View" buttons to navigate to patient details\n‚Ä¢ Use the search bar to find specific patients\n‚Ä¢ Contact support for technical assistance');
    }

    function showContact() {
      alert('Contact Support\n\nEmail: support@strokesystem.edu\nPhone: (404) 555-STROKE\nHours: 24/7 Emergency Support\n\nFor technical issues, please include:\n‚Ä¢ Patient code\n‚Ä¢ Error message\n‚Ä¢ Steps to reproduce');
    }


    // Load today's scan count
    async function loadTodayScans() {
      try {
        const response = await fetch('/dashboard-stats');
        if (response.ok) {
          const stats = await response.json();
          // For now, we'll use a random number as we don't have today-specific data
          const todayScans = Math.floor(Math.random() * 15) + 5;
          document.getElementById('todayScans').textContent = todayScans;
        }
      } catch (error) {
        console.error('Error loading today\'s scans:', error);
        document.getElementById('todayScans').textContent = 'N/A';
      }
    }

    // Update last update time
    function updateLastUpdateTime() {
      const now = new Date();
      const timeString = now.toLocaleString();
      document.getElementById('lastUpdate').textContent = timeString;
    }
  </script>
</body>
</html>
